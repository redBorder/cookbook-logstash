# This file was generated by Chef
<% if @sensor_nodes.count > 0 %>
filter {

  <% @sensor_nodes.each do |node| %>
    <% next unless node["rbname"] && node["redborder"] && node["redborder"]["linked_devices"] && node["redborder"]["linked_devices"].count > 0 && node["redborder"]["sensor_uuid"] %>
    <% main_device = node["redborder"]["linked_devices"].first %>
    <% next unless main_device && main_device["id"] && main_device["name"] && main_device["device_role"] %>
  # Checking sensor: <%= node['rbname'] %>
  if [sensor_uuid] == "<%= node['redborder']['sensor_uuid'] %>" {
    mutate {
      add_field => {
        "device_id"   => "<%= main_device["id"] %>"
        "device_name" => "<%= main_device["name"] %>"
        "device_role" => "<%= main_device["device_role"] %>"
      }
    }
  }

  <% end %>
}
<% end %>
