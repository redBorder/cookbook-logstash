filter {
  ruby {
    code => '
      filename = event.get("file_path")
      if filename
        filename = filename.sub(%r{^/usr/share/malware/}, "")
        event.set("filename", filename)
      end
    '
  }

  if ![incident_uuid] {
    incident_enrichment {
      incident_fields => ["malware_score", "sha256", "filename"]
      source => "Malware"
      malware_score_threshold => <%= @malware_score_threshold %>
      redis_hosts => <%= @redis_hosts %>
      redis_port => <%= @redis_port %>
      redis_password => "<%= @redis_password %>"
    }
  }
}